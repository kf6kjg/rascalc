<!DOCTYPE html>
<html lang="en-us">
	<head>
		<title>Rās Online Score Computer</title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link
			href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700"
			media="screen"
			rel="stylesheet"
			type="text/css"
		/>
		<link
			href="//cdn.muicss.com/mui-0.10.3/css/mui.min.css"
			rel="stylesheet"
			type="text/css"
		/>
		<script src="//cdn.muicss.com/mui-0.10.3/js/mui.min.js"></script>
		<style type="text/css">
			/**
			* Body CSS
			*/
			html,
			body {
				font-family: "Roboto", "Helvetica Neue", Helvetica, Arial;
				height: 100%;
			}

			html,
			body,
			input,
			textarea,
			select,
			button {
				-webkit-font-smoothing: antialiased;
				-moz-osx-font-smoothing: grayscale;
				text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.004);
			}

			div[data-postfix] {
				position: relative;
			}
			div[data-postfix]::after {
				position: absolute;
				bottom: 3px;
				right: 0.5em;
				transition: all 0.05s ease-in-out;
				content: attr(data-postfix);
			}
			div[data-postfix]:hover::after,
			div[data-postfix]:focus-within::after {
				right: 1.5em;
			}
			@supports (-moz-appearance: none) {
				div[data-postfix]::after {
					right: 1.5em;
				}
			}
		</style>
		<script type="text/javascript">
			function rollDie(sides) {
				return Math.floor(Math.random() * sides) + 1;
			}

			function calculate() {
				const roundNode = document.getElementById("round");

				const form = document.querySelector("form");
				if (form.checkValidity && !form.checkValidity()) {
					throw new Error("Invalid value in form");
				}

				const d0Node = document.getElementById("damageInitial");
				const D0 = Number(d0Node.value);
				const v0Node = document.getElementById("velocityInitial");
				const V0 = Number(v0Node.value);
				const t0Node = document.getElementById("totalTime");
				const T0 = Number(t0Node.value);

				const oxNode = document.getElementById("distance");
				const Ox = Number(oxNode.value);
				const ovNode = document.getElementById("bestVelocity");
				const Ov = Number(ovNode.value);
				const osNode = document.getElementById("bestVelocitySign");
				const Os = osNode.value;
				const doNode = document.getElementById("danger");
				const Od = Number(doNode.value);

				const smNode = document.getElementById("maneuverability");
				const Sm = Number(smNode.value);
				const saNode = document.getElementById("armor");
				const Sa = Number(saNode.value);
				const stNode = document.getElementById("thrust");
				const St = Number(stNode.value);
				const sdNode = document.getElementById("damage");
				const Sd = Number(sdNode.value);

				const Ds = Math.max(
					0,
					Os * Math.floor((Od * (Ov - V0)) / (Sm + Sa + 1))
				);

				const V = Math.floor(Math.sqrt(V0 * V0 + 2 * St * Ox) / (D0 + Ds + 1));

				const T = Math.floor((2 * Ox) / (V0 + V)) + 1;

				const D = Math.max(0, D0 + Ds + T * Sd);

				const totalTime = T + T0;

				d0Node.value = D;
				v0Node.value = V;
				t0Node.value = totalTime;

				// Record
				const roundLog = document.createElement("td");
				roundLog.innerText = roundNode.value;
				const damageLog = document.createElement("td");
				damageLog.innerText = D;
				const velocityLog = document.createElement("td");
				velocityLog.innerText = V;
				const transitTimeLog = document.createElement("td");
				transitTimeLog.innerText = T;
				const totalTimeLog = document.createElement("td");
				totalTimeLog.innerText = totalTime;

				const row = document.createElement("tr");
				row.appendChild(roundLog);
				row.appendChild(damageLog);
				row.appendChild(velocityLog);
				row.appendChild(transitTimeLog);
				row.appendChild(totalTimeLog);
				document.getElementById("results").appendChild(row);

				roundNode.value++;
			}

			function reset() {
				const log = document.getElementById("results");
				while (log.firstChild) {
					log.removeChild(log.firstChild);
				}

				document.getElementById("round").value = 1;

				document.getElementById("damageInitial").value = 0;
				document.getElementById("velocityInitial").value = 0;
				document.getElementById("totalTime").value = 0;

				document.getElementById("distance").value = "";
				document.getElementById("bestVelocity").value = "";
				document.getElementById("bestVelocitySign").value = "+";
				document.getElementById("danger").value = "";

				document.getElementById("maneuverability").value = "";
				document.getElementById("armor").value = "";
				document.getElementById("thrust").value = "";
				document.getElementById("damage").value = "";
			}

			function testRounding() {
				var x = -2.1;
				const logEntry = document.createElement("td");
				logEntry.colSpan = 5;
				logEntry.innerText =
					"floor(" +
					x +
					") = " +
					Math.floor(x) +
					", parseInt(" +
					x +
					") = " +
					parseInt(x, 10);

				const row = document.createElement("tr");
				row.appendChild(logEntry);
				document.getElementById("results").appendChild(row);
			}
		</script>
	</head>
	<body>
		<div id="form" class="mui-container">
			<h1>Rās Online Score Computer</h1>
			<form class="mui-form">
				<div class="mui-panel">
					<legend>
						<h2>Current Status</h2>
						<p>Typically you won't need to adjust these.</p>
					</legend>
					<div class="mui-textfield float-label">
						<input id="round" type="number" inputmode="decimal" value="1" />
						<label for="round">Round</label>
					</div>
					<div class="mui-textfield float-label">
						<input
							id="damageInitial"
							type="number"
							inputmode="decimal"
							value="0"
						/>
						<label for="damageInitial">Damage</label>
					</div>
					<div class="mui-textfield float-label" data-postfix="AU/h">
						<input
							id="velocityInitial"
							type="number"
							inputmode="decimal"
							value="0"
						/>
						<label for="velocityInitial">Velocity</label>
					</div>
					<div class="mui-textfield float-label" data-postfix="hours">
						<input id="totalTime" type="number" inputmode="decimal" value="0" />
						<label for="totalTime">Total Time</label>
					</div>
				</div>
				<div class="mui-panel">
					<legend>
						<h2>Current Ship Information</h2>
						<p>Enter the values from the totals of your Ship and Mod Cards</p>
					</legend>
					<div class="mui-textfield float-label">
						<input
							id="maneuverability"
							type="number"
							inputmode="decimal"
							placeholder="0"
							required
						/>
						<label for="maneuverability">Maneuverability</label>
					</div>
					<div class="mui-textfield float-label">
						<input
							id="armor"
							type="number"
							inputmode="decimal"
							placeholder="0"
							required
						/>
						<label for="armor">Armor</label>
					</div>
					<div class="mui-textfield float-label" data-postfix="AU/h^2">
						<input
							id="thrust"
							type="number"
							inputmode="decimal"
							placeholder="0"
							required
						/>
						<label for="thrust">Thrust</label>
					</div>
					<div class="mui-textfield float-label" data-postfix="units/h">
						<input
							id="damage"
							type="number"
							inputmode="decimal"
							placeholder="0"
							required
						/>
						<label for="damage">Damage</label>
					</div>
				</div>
				<div class="mui-panel">
					<legend>
						<h2>Current Obstacle Information</h2>
						<p>Enter the values from the current Obstacle Card</p>
					</legend>
					<div class="mui-textfield float-label" data-postfix="AU">
						<input
							id="distance"
							type="number"
							inputmode="decimal"
							placeholder="0"
							required
						/>
						<label for="distance">Distance</label>
					</div>
					<div class="mui-textfield float-label" data-postfix="AU/h">
						<input
							id="bestVelocity"
							type="number"
							inputmode="decimal"
							placeholder="0"
							required
						/>
						<label for="bestVelocity">Recommended Velocity</label>
					</div>
					<div class="mui-select float-label">
						<select id="bestVelocitySign">
							<option selected="selected" value="+">+</option>
							<option value="-">-</option>
						</select>
						<label for="bestVelocitySign">Recommended Velocity Flag</label>
					</div>
					<div class="mui-textfield float-label">
						<input
							id="danger"
							type="number"
							inputmode="decimal"
							placeholder="0"
							required
						/>
						<label for="danger">Danger</label>
					</div>
				</div>
				<input
					type="button"
					onclick="reset();"
					value="Clear all"
					class="mui-btn mui-btn--danger"
				/>
				<input
					type="submit"
					onclick="calculate();"
					value="Calculate"
					class="mui-btn mui-btn--primary mui-btn--raised mui--pull-right"
				/>
			</form>
		</div>
		<div class="mui-container">
			<div class="mui-panel">
				<legend>
					<h2>Log</h2>
				</legend>
				<table class="mui-table mui-table--bordered">
					<thead>
						<tr>
							<th>Round</th>
							<th>Damage</th>
							<th>Velocity (AU/hr)</th>
							<th>Transit Time (hours)</th>
							<th>Total Time (hours)</th>
						</tr>
					</thead>
					<tbody id="results"></tbody>
				</table>
			</div>
			<p>
				Note: due to rounding issues there might be some inaccuracies.
				<a href="javascript:testRounding();">Click to test these issues.</a>
			</p>
		</div>
	</body>
</html>
